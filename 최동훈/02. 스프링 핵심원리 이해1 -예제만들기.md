### íšŒì› ë„ë©”ì¸ í˜‘ë ¥ ê´€ê³„

---


![image](https://github.com/SpringSync/Spring-Basic/assets/58305106/26bb8721-51cb-46c9-8385-3d6877d3b009)

- ì• ê°•ì˜ì—ì„œ ë°°ìš´ OCP : ê°œë°© íì‡  ì›ì¹™
- ë³€ê²½ì—ëŠ” ë‹«í˜€ìˆê³  í™•ì¥ì—ëŠ” ì—´ë ¤ìˆë‹¤.

![image](https://github.com/SpringSync/Spring-Basic/assets/58305106/4c53cbfa-c5e8-484c-8967-aa36c65ed732)

- ì•„ì§ ë ˆí¬ì§€í† ë¦¬ë¥¼ ì„œë²„ ë‚´ë¶€ Mapì„ í™œìš©í• ì§€ ëª»ì •í•œ ìƒí™© â†’ êµ¬í˜„ì´ ì•„ë‹ˆë¼ ì—­í• ì— ì˜ì¡´í•˜ë„ë¡ ì„¤ê³„
- ì–¸ì œë“ ì§€ ê°ˆì•„ë¼ìš¸ìˆ˜ ìˆë„ë¡ ì„¤ê³„

### ì—­í• (ì¸í„°í˜ì´ìŠ¤)

```java
public interface OrderService {

    Order createOrder(Long memberId, String itemName, int itemPrice);
}
```

### êµ¬í˜„(ê°ì²´)

```java
public class OrderServiceImpl implements OrderService{
    private  final MemberRepository memberRepository = new MemoryMemberReposotiry();
    private  final DiscountPolicy discountPolicy = new FixDiscountPolicy();

    @Override
    public Order createOrder(Long memberId, String itemName, int itemPrice) {
        Member member = memberRepository.findById(memberId);
        int discout = discountPolicy.discout(member, itemPrice);
        return new Order(memberId,itemName,itemPrice,discout);
    }

}
```

### íšŒì› ë“±ê¸‰

```java
public enum Grade {
 BASIC,
 VIP
}
```

- **ENUM ?**
    - enumì˜ í•µì‹¬ì€ ì´ëŸ¬í•œ ìƒìˆ˜ë¥¼ ë‹¨ìˆœíˆ ì •ìˆ˜ë¡œ ì¹˜ë¶€í•˜ì§€ë§ê³  ê°ì²´ ì§€í–¥ì ìœ¼ë¡œ ê°ì²´í™”í•´ì„œ ê´€ë¦¬í•˜ìëŠ” ì·¨ì§€ì´ë‹¤.
    - JAVAì˜ enumì€ ì¸í„°í˜ì´ìŠ¤ì™€ ê°™ì´ ë…ë¦½ëœ íŠ¹ìˆ˜í•œ í´ë˜ìŠ¤ë¡œ êµ¬ë¶„í•œë‹¤. ì¦‰, ì¼ì¢…ì˜ ê°ì²´ì´ê¸° ë•Œë¬¸ì— í™(heap) ë©”ëª¨ë¦¬ì— ì €ì¥ë˜ë©° ê° enum ìƒìˆ˜ë“¤ì€ ë³„ê°œì˜ ë©”ëª¨ë¦¬ ì£¼ì†Œê°’ì„ ê°€ì§ìœ¼ë¡œì¨ ì™„ë²½íˆ ë…ë¦½ëœ ìƒìˆ˜ë¥¼ êµ¬ì„±í•  ìˆ˜ ìˆëŠ” ê²ƒì´ë‹¤
    - ë¦¬í™í† ë§ì‹œ ë³€ê²½ ë²”ìœ„ ìµœì†Œí™”
    

### íšŒì› ì €ì¥ì†Œ

---

### ì—­í• (ì¸í„°í˜ì´ìŠ¤)

```java
public interface MemberRepository {
 void save(Member member);
 Member findById(Long memberId);
}
```

### êµ¬í˜„(ê°ì²´)

```java
package hello.core.member;
import java.util.HashMap;
import java.util.Map;
public class MemoryMemberRepository implements MemberRepository {
 private static Map<Long, Member> store = new HashMap<>();
 @Override
 public void save(Member member) {
 store.put(member.getId(), member);
 }
 @Override
 public Member findById(Long memberId) {
 return store.get(memberId);
 }
}
```

<aside>
ğŸ’¡ `HashMap` ì€ ë™ì‹œì„± ì´ìŠˆê°€ ë°œìƒí•  ìˆ˜ ìˆë‹¤. ì´ëŸ° ê²½ìš° ConcurrentHashMap ì„ ì‚¬ìš©í•˜ì.

</aside>

- **ë™ì‹œì„± ì´ìŠˆ ?**
    - ë™ì¼í•œ í•˜ë‚˜ì˜ ë°ì´í„°ì— 2ê°œ ì´ìƒì˜ ìŠ¤ë ˆë“œ, í˜¹ì€ ì„¸ì…˜ì—ì„œ ê°€ë³€ë°ì´í„°ë¥¼ ë™ì‹œì— ì œì–´í• ë•Œ ë‚˜íƒ€ë‚˜ëŠ” ë¬¸ì œ
    - **í•´ê²°ë²•**
    - SynchronizedMap ì‚¬ìš© â†’ í•´ë‹¹ í‚¤ì›Œë“œ ì‚¬ìš©ì‹œ ì „ì²´ Map ë½ ê±¸ì–´ì„œ ë¬´ê²°ì„± ë³´ì¥
    - Redis Lettuce ì´ìš©

### í…ŒìŠ¤íŠ¸ ì½”ë“œ

---

### ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë€ ?

- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸(Unit Test)ëŠ” í•˜ë‚˜ì˜ ëª¨ë“ˆì„ ê¸°ì¤€ìœ¼ë¡œ **ë…ë¦½ì ìœ¼ë¡œ ì§„í–‰ë˜ëŠ” ê°€ì¥ ì‘ì€ ë‹¨ìœ„ì˜ í…ŒìŠ¤íŠ¸.**
- ì—¬ê¸°ì„œ ëª¨ë“ˆì€ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ì‘ë™í•˜ëŠ” **í•˜ë‚˜ì˜ ê¸°ëŠ¥ ë˜ëŠ” ë©”ì†Œë“œ**ë¡œ ì´í•´í•  ìˆ˜ ìˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì—ì„œ ë¡œê·¸ì¸ ë©”ì†Œë“œì— ëŒ€í•œ ë…ë¦½ì ì¸ í…ŒìŠ¤íŠ¸ê°€ 1ê°œì˜ ë‹¨ìœ„í…ŒìŠ¤íŠ¸ê°€ ë  ìˆ˜ ìˆë‹¤.

### íšŒì› ê°€ì… í…ŒìŠ¤íŠ¸

```java
class MemberServiceTest {

 MemberService memberService = new MemberServiceImpl();
 @Test
 void join() {
 //given
 Member member = new Member(1L, "memberA", Grade.VIP);
 //when
 memberService.join(member);
 Member findMember = memberService.findMember(1L);
 //then
 Assertions.assertThat(member).isEqualTo(findMember);
 }
}
```

---

### ìœ„ ì½”ë“œì˜ ë¬¸ì œì  ?

---

```java
public class MemberServiceImpl implements MemberService {
    //DIP ìœ„ë°˜ : ê°ì²´ê°€ ì—­í• (ì¶”ìƒí™”)ì™€ êµ¬í˜„(êµ¬ì²´í™”) ëª¨ë‘ì— ì˜ì¡´í•˜ê³  ìˆìŒ. ì¶”ìƒí™”ì—ë§Œ ì˜ì¡´í•´ì•¼í•¨.
    private final MemberRepository memberRepository = new MemoryMemberReposotiry();

    @Override
    public void join(Member member) {
        memberRepository.save(member);
    }

    @Override
    public Member findMember(Long memberId) {
        return memberRepository.findById(memberId);
    }
}
```

- **DIP ì›ì¹™ì„ ìœ„ë°˜í•œ ì„¤ê³„**
    - íŠ¹íˆ
    - `private  final MemberRepository memberRepository = new MemoryMemberReposotiry();` ì´ ë¶€ë¶„ì—ì„œ ServiceImpl ì´ë€ í´ë˜ìŠ¤ëŠ” êµ¬í˜„ ê°ì²´ì¸ MemoryMemberRepository()ì™€ ì—­í• (ì¸í„°í˜ì´ìŠ¤)ì¸ memberRepository ëª¨ë‘ì— ì˜ì¡´í•˜ê³  ìˆìŒ.
    

### ì£¼ë¬¸ê³¼ í• ì¸ ë„ë©”ì¸

---

![image](https://github.com/SpringSync/Spring-Basic/assets/58305106/1a504b8c-823b-438a-8d54-f3b3d9bc279b)

<aside>
ğŸ’¡ ìœ„ì˜ ë‹¤ì´ì–´ê·¸ë¨ì„ ì˜ ë³´ë©´ ëª¨ë‘ **ì—­í•  ì—ë§Œ ì˜ì¡´** í•˜ê³  ìˆë‹¤.

</aside>

### ê°ì²´ ë‹¤ì´ì–´ê·¸ë¨

---

![image](https://github.com/SpringSync/Spring-Basic/assets/58305106/47f0603a-1161-4ccf-a151-e15bf86c4d99)

<aside>
ğŸ’¡ ìœ„ì˜ ë‹¤ì´ì–´ê·¸ë¨ì„ ê°ì²´ ë‹¤ì´ì–´ê·¸ë¨ìœ¼ë¡œ í‘œí˜„í•œ ëª¨ìŠµ
ëª¨ë‘ **interface** ì—ë§Œ ì˜ì¡´í•˜ê³  ìˆëŠ”ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

</aside>

- ë§Œì•½ í• ì¸ì •ì±…ì´ ì •ë¥ ì´ ì•„ë‹Œ ì •ì•¡ì œë¡œ ë³€ê²½ë˜ì—ˆì„ ê²½ìš°ì— ì–¸ì œë“ ì§€ ê°ˆì•„ë¼ìš¸ìˆ˜ ìˆë„ë¡ ë§Œë“¤ê¸° ìœ„í•¨ì´ë‹¤.

### í• ì¸ì •ì±… ì—­í• 

```java
public interface DiscountPolicy {
 /**
 * @return í• ì¸ ëŒ€ìƒ ê¸ˆì•¡
 */
 int discount(Member member, int price);
}
```

### í• ì¸ì •ì±… êµ¬í˜„ê°ì²´

```java
public class FixDiscountPolicy implements DiscountPolicy{
    private int discountFixAmount = 1000;
    @Override
    public int discout(Member member, int price) {
        if (member.getGrade() == Grade.VIP) {
            return discountFixAmount;
        }
        return 0;
    }
}
```

### ì£¼ë¬¸ ì—”í‹°í‹°

```java
@Getter
@Setter
@Data
public class Order {
    private Long memberId;
    private String itemName;
    private int itemPrice;
    private int discountPrice;

    public Order(Long memberId, String itemName, int itemPrice, int discountPrice) {
        this.memberId = memberId;
        this.itemName = itemName;
        this.itemPrice = itemPrice;
        this.discountPrice = discountPrice;
    }

    @Override
    public String toString() {
        return "Order{" +
                "memberId=" + memberId +
                ", itemName='" + itemName + '\'' +
                ", itemPrice=" + itemPrice +
                ", discountPrice=" + discountPrice +
                '}'
                +"\n"
                +"order.calculatePrice="+String.valueOf(itemPrice-discountPrice);
    }
}
```

<aside>
ğŸ’¡ ì—¬ê¸°ì„œ @toStringì„ ì˜¤ë²„ë¼ì´ë“œ â†’ ìë°”ì˜ ëª¨ë“  í´ë˜ìŠ¤ëŠ” Object í´ë˜ìŠ¤ë¥¼ ìƒì† ë°›ìŒ.

</aside>

### ì£¼ë¬¸ ì„œë¹„ìŠ¤ ì—­í• (ì¸í„°í˜ì´ìŠ¤)

---

```java
public interface OrderService {
 Order createOrder(Long memberId, String itemName, int itemPrice);
}
```

### ì£¼ë¬¸ì„œë¹„ìŠ¤ êµ¬í˜„(ê°ì²´)

---

```java
public class OrderServiceImpl implements OrderService{
    private  final MemberRepository memberRepository = new MemoryMemberReposotiry();
    private  final DiscountPolicy discountPolicy = new FixDiscountPolicy();

    @Override
    public Order createOrder(Long memberId, String itemName, int itemPrice) {
        Member member = memberRepository.findById(memberId);
        int discout = discountPolicy.discout(member, itemPrice);
        return new Order(memberId,itemName,itemPrice,discout);
    }

}
```

### ì£¼ë¬¸ ì„œë¹„ìŠ¤ í…ŒìŠ¤íŠ¸ì½”ë“œ ì‘ì„±
